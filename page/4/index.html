<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="say something about me">
<meta property="og:type" content="website">
<meta property="og:title" content="BlankLin">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="BlankLin">
<meta property="og:description" content="say something about me">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Blank Lin">
<meta property="article:tag" content="lazy and boring">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>BlankLin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="BlankLin" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlankLin</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">lazy and boring</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/10/java-interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/10/java-interview/" class="post-title-link" itemprop="url">java面试常见问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-10 10:09:55" itemprop="dateCreated datePublished" datetime="2021-10-10T10:09:55+08:00">2021-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><ul>
<li>目的：参数化类型</li>
<li>用法：泛型类、泛型接口、泛型方法<ul>
<li>泛型类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 简单范型</span><br><span class="line">class Test&lt;T&gt; &#123;</span><br><span class="line">  private T var;</span><br><span class="line">  public T getVar() &#123;</span><br><span class="line">    return var;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setVar(T var) &#123;</span><br><span class="line">    this.var &#x3D; var;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line">&#x2F;&#x2F; 多元泛型</span><br><span class="line">class TestKV&lt;K,V&gt; &#123;</span><br><span class="line">  private K key;</span><br><span class="line">  private V value;</span><br><span class="line">  public K getKey() &#123;</span><br><span class="line">    return key;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setKey(K key) &#123;</span><br><span class="line">    this.key &#x3D; key;</span><br><span class="line">  &#125;</span><br><span class="line">  public V getValue() &#123;</span><br><span class="line">    return value;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setValue(V value) &#123;</span><br><span class="line">    this.value &#x3D; value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Demo &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    Test&lt;String&gt; test &#x3D; new Test&lt;String&gt;();</span><br><span class="line">    test.setVar(&quot;aa&quot;);</span><br><span class="line">    System.out.println(test.getVar());</span><br><span class="line"></span><br><span class="line">    TestKV&lt;String, String&gt; testKV &#x3D; new TestKV&lt;String, String&gt;();</span><br><span class="line">    testKV.setKey(&quot;hello&quot;);</span><br><span class="line">    testKV.setValue(&quot;world&quot;);</span><br><span class="line">    System.out.println(testKV.getKey() +&quot;:&quot;+testKV.getValue());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>泛型接口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">interface Test&lt;T&gt; &#123;</span><br><span class="line">  public T getVar();</span><br><span class="line">&#125;</span><br><span class="line">class TestImpl&lt;T&gt; implement Test&lt;T&gt; &#123;</span><br><span class="line">  private T var;</span><br><span class="line">  public TEstImpl(T var) &#123;</span><br><span class="line">    this.var &#x3D; var;</span><br><span class="line">  &#125;</span><br><span class="line">  public T getVar() &#123;</span><br><span class="line">    return var;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setVar(T var) &#123;</span><br><span class="line">    this.var &#x3D; var;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Demo&#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    Test&lt;String&gt; test &#x3D; new TestImpl&lt;String&gt;(&quot;tom&quot;);</span><br><span class="line">    System.out.pringln(test.getVar());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>泛型方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Demo &#123;</span><br><span class="line">  public &lt;T&gt; T getObject(Class&lt;T&gt; c) &#123;</span><br><span class="line">    T t &#x3D; c.newInstance();</span><br><span class="line">    retrun t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/02/wireshard3.4.8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/02/wireshard3.4.8/" class="post-title-link" itemprop="url">wireshark3.4.8保姆级入门教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-02 10:09:55" itemprop="dateCreated datePublished" datetime="2021-10-02T10:09:55+08:00">2021-10-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/introduction/" itemprop="url" rel="index"><span itemprop="name">introduction</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="wireshark3-4-8，主界面"><a href="#wireshark3-4-8，主界面" class="headerlink" title="wireshark3.4.8，主界面"></a>wireshark3.4.8，主界面</h2><p><img src="/images/wireshark/1.png" alt="avatar"></p>
<h2 id="通过ping简单入门"><a href="#通过ping简单入门" class="headerlink" title="通过ping简单入门"></a>通过ping简单入门</h2><ul>
<li>启动wireshark后，wireshark处于抓包状态中<br><img src="/images/wireshark/2.png" alt="avatar"></li>
<li>在终端输入ping命令后<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure>
<img src="/images/wireshark/3.png" alt="avatar"></li>
<li>通过过滤栏设置过滤条件进行数据包列表过滤<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr &#x3D;&#x3D; 180.101.49.12 and icmp</span><br></pre></td></tr></table></figure>
<img src="/images/wireshark/4.png" alt="avatar"></li>
</ul>
<blockquote>
<p>ICMP（Internet Control Message Protocol）Internet控制报文协议。它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。 ICMP协议是一种面向无连接的协议。</p>
</blockquote>
<h2 id="wireshark抓包界面介绍"><a href="#wireshark抓包界面介绍" class="headerlink" title="wireshark抓包界面介绍"></a>wireshark抓包界面介绍</h2><p><img src="/images/wireshark/5.png" alt="avatar"></p>
<ul>
<li>Display Filter(显示过滤器)，  用于设置过滤条件进行数据包列表过滤。菜单路径：Analyze —&gt; Display Filters。</li>
<li>Packet List Pane(数据包列表)， 显示捕获到的数据包，每个数据包包含编号，时间戳，源地址，目标地址，协议，长度，以及数据包信息。 不同协议的数据包使用了不同的颜色区分显示</li>
<li>Packet Details Pane(数据包详细信息), 在数据包列表中选择指定数据包，在数据包详细信息中会显示数据包的所有详细信息内容。数据包详细信息面板是最重要的，用来查看协议中的每一个字段。各行信息分别为<br>（1）Frame:   物理层的数据帧概况<br>（2）Ethernet II: 数据链路层以太网帧头部信息<br>（3）Internet Protocol Version 4: 互联网层IP包头部信息<br>（4）Transmission Control Protocol:  传输层T的数据段头部信息，此处是TCP<br>（5）Hypertext Transfer Protocol:  应用层的信息，此处是HTTP协议<br><img src="/images/wireshark/6.png" alt="avatar"></li>
</ul>
<h3 id="TCP包的具体内容"><a href="#TCP包的具体内容" class="headerlink" title="TCP包的具体内容"></a>TCP包的具体内容</h3><p><img src="/images/wireshark/7.png" alt="avatar"></p>
<h3 id="抓包过滤器语法"><a href="#抓包过滤器语法" class="headerlink" title="抓包过滤器语法"></a>抓包过滤器语法</h3><ul>
<li>抓包过滤器语法和实例<blockquote>
<p>抓包过滤器类型Type（host、net、port）、方向Dir（src、dst）、协议Proto（ether、ip、tcp、udp、http、icmp、ftp等）、逻辑运算符（&amp;&amp; 与、|| 或、！非）</p>
</blockquote>
</li>
</ul>
<p>（1）协议过滤</p>
<p>  比较简单，直接在抓包过滤框中直接输入协议名即可。</p>
<p>  TCP，只显示TCP协议的数据包列表</p>
<p>  HTTP，只查看HTTP协议的数据包列表</p>
<p>  ICMP，只显示ICMP协议的数据包列表</p>
<p>（2）IP过滤</p>
<p>  host 192.168.1.104</p>
<p>  src host 192.168.1.104</p>
<p>  dst host 192.168.1.104</p>
<p>（3）端口过滤</p>
<p>  port 80</p>
<p>  src port 80</p>
<p>  dst port 80</p>
<p>（4）逻辑运算符&amp;&amp; 与、|| 或、！非</p>
<p>  src host 192.168.1.104 &amp;&amp; dst port 80 抓取主机地址为192.168.1.80、目的端口为80的数据包</p>
<p>  host 192.168.1.104 || host 192.168.1.102 抓取主机为192.168.1.104或者192.168.1.102的数据包</p>
<p>  ！broadcast 不抓取广播数据包</p>
<p>2、显示过滤器语法和实例</p>
<p>（1）比较操作符</p>
<p>  比较操作符有== 等于、！= 不等于、&gt; 大于、&lt; 小于、&gt;= 大于等于、&lt;=小于等于。</p>
<p>（2）协议过滤</p>
<p>  比较简单，直接在Filter框中直接输入协议名即可。注意：协议名称需要输入小写。</p>
<p>  tcp，只显示TCP协议的数据包列表</p>
<p>  http，只查看HTTP协议的数据包列表</p>
<p>  icmp，只显示ICMP协议的数据包列表  </p>
<p>（3） ip过滤</p>
<p>   ip.src ==192.168.1.104 显示源地址为192.168.1.104的数据包列表</p>
<p>   ip.dst==192.168.1.104, 显示目标地址为192.168.1.104的数据包列表</p>
<p>   ip.addr == 192.168.1.104 显示源IP地址或目标IP地址为192.168.1.104的数据包列表</p>
<p>（4）端口过滤</p>
<p>  tcp.port ==80,  显示源主机或者目的主机端口为80的数据包列表。</p>
<p>  tcp.srcport == 80,  只显示TCP协议的源主机端口为80的数据包列表。</p>
<p>  tcp.dstport == 80，只显示TCP协议的目的主机端口为80的数据包列表。  </p>
<p>（5） Http模式过滤</p>
<p>  http.request.method==”GET”,   只显示HTTP GET方法的。</p>
<p>（6）逻辑运算符为 and/or/not</p>
<p>  过滤多个条件组合时，使用and/or。比如获取IP地址为192.168.1.104的ICMP数据包表达式为ip.addr == 192.168.1.104 and icmp</p>
<h3 id="wireshark抓包分析tcp3次握手"><a href="#wireshark抓包分析tcp3次握手" class="headerlink" title="wireshark抓包分析tcp3次握手"></a>wireshark抓包分析tcp3次握手</h3><blockquote>
<p>以某天气预报api举例,<a href="http://jisutianqi.market.alicloudapi.com/weather/query" target="_blank" rel="noopener">http://jisutianqi.market.alicloudapi.com/weather/query</a></p>
<ul>
<li>启动wireshark</li>
<li>用浏览器访问<a href="http://jisutianqi.market.alicloudapi.com/weather/query" target="_blank" rel="noopener">地址</a></li>
<li>在终端输入，得到实际ip地址<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping jisutianqi.market.alicloudapi.com</span><br></pre></td></tr></table></figure>
<img src="/images/wireshark/8.png" alt="avatar"></li>
<li>在wireshark上过滤<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr &#x3D;&#x3D; 47.97.242.71</span><br></pre></td></tr></table></figure>
<img src="/images/wireshark/9.png" alt="avatar"><br>图中可以看到wireshark截获到了三次握手的三个数据包。第四个包才是HTTP的， 这说明HTTP的确是使用TCP建立连接的。</li>
<li>第一次握手抓包<br>客户端发送一个TCP，标志位为SYN，序列号为0， 代表客户端请求建立连接。 如下图。<br><img src="/images/wireshark/10.png" alt="avatar"><br>数据包的关键属性如下：<ul>
<li>SYN ：标志位，表示请求建立连接</li>
<li>Seq = 0 ：初始建立连接值为0，数据包的相对序列号从0开始，表示当前还没有发送数据</li>
<li>Ack =0：初始建立连接值为0，已经收到包的数量，表示当前没有接收到数据</li>
</ul>
</li>
<li>第二次握手抓包<br>服务器发回确认包, 标志位为 SYN,ACK. 将确认序号(Acknowledgement Number)设置为客户的I S N加1以.即0+1=1, 如下图<br><img src="/images/wireshark/11.png" alt="avatar"><br>数据包的关键属性如下：<ul>
<li>[SYN + ACK]: 标志位，同意建立连接，并回送SYN+ACK</li>
<li>Seq = 0 ：初始建立值为0，表示当前还没有发送数据</li>
<li>Ack = 1：表示当前端成功接收的数据位数，虽然客户端没有发送任何有效数据，确认号还是被加1，因为包含SYN或FIN标志位。（并不会对有效数据的计数产生影响，因为含有SYN或FIN标志位的包并不携带有效数据）</li>
</ul>
</li>
<li>第三次握手抓包<br>客户端再次发送确认包(ACK) SYN标志位为0,ACK标志位为1.并且把服务器发来ACK的序号字段+1,放在确定字段中发送给对方.并且在数据段放写ISN的+1, 如下图:<br><img src="/images/wireshark/12.png" alt="avatar"><br>数据包的关键属性如下：<ul>
<li>ACK ：标志位，表示已经收到记录</li>
<li>Seq = 1 ：表示当前已经发送1个数据</li>
<li>Ack = 1 : 表示当前端成功接收的数据位数，虽然服务端没有发送任何有效数据，确认号还是被加1，因为包含SYN或FIN标志位（并不会对有效数据的计数产生影响，因为含有SYN或FIN标志位的包并不携带有效数据)。</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>在TCP层，有个FLAGS字段，这个字段有以下几个标识：SYN, FIN, ACK, PSH, RST, URG。如下<br><img src="/images/wireshark/13.png" alt="avatar"><br>其中，对于我们日常的分析有用的就是前面的五个字段。它们的含义是：<ul>
<li>SYN表示建立连接，</li>
<li>FIN表示关闭连接，</li>
<li>ACK表示响应，</li>
<li>PSH表示有DATA数据传输，</li>
<li>RST表示连接重置</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/01/clickhouse-mac-compile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/01/clickhouse-mac-compile/" class="post-title-link" itemprop="url">mac下编译clickhouse</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-01 10:09:55" itemprop="dateCreated datePublished" datetime="2021-10-01T10:09:55+08:00">2021-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 19:34:56" itemprop="dateModified" datetime="2022-11-29T19:34:56+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="安装Homebrew"><a href="#安装Homebrew" class="headerlink" title="安装Homebrew"></a>安装Homebrew</h3><blockquote>
<p>Homebrew要安装正确, 确保/usr/local下面出现各种share/include等目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;bin&#x2F;zsh -c &quot;$(curl -fsSL https:&#x2F;&#x2F;gitee.com&#x2F;cunkai&#x2F;HomebrewCN&#x2F;raw&#x2F;master&#x2F;Homebrew.sh)&quot;</span><br></pre></td></tr></table></figure></p>
<h3 id="安装环境所需插件"><a href="#安装环境所需插件" class="headerlink" title="安装环境所需插件"></a>安装环境所需插件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install cmake ninja libtool gettext ccache</span><br></pre></td></tr></table></figure>
<h3 id="修正objcopy的问题"><a href="#修正objcopy的问题" class="headerlink" title="修正objcopy的问题"></a>修正objcopy的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install binutils</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;opt&#x2F;binutils&#x2F;bin&#x2F;objcopy &#x2F;usr&#x2F;local&#x2F;bin&#x2F;objcopy</span><br></pre></td></tr></table></figure>
<h3 id="clion打开clickouse-local不成功，无法正常编译debug"><a href="#clion打开clickouse-local不成功，无法正常编译debug" class="headerlink" title="clion打开clickouse local不成功，无法正常编译debug"></a>clion打开clickouse local不成功，无法正常编译debug</h3><p>1&gt; 安装llvm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install llvm</span><br></pre></td></tr></table></figure><br>2&gt; 配置clion的工具链ToolChain<br><img src="/images/clickhouse/1.png" alt="avatar"><br>cmake和make是新版本就可以了，配置好c和c++编译器(compiler)使用刚装好的llvm下的clang</p>
</blockquote>
<h3 id="安装googletest"><a href="#安装googletest" class="headerlink" title="安装googletest"></a>安装googletest</h3><p>有报错ld: library not found for -lgtest<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install googletest</span><br></pre></td></tr></table></figure><br><img src="/images/clickhouse/8.png" alt="avatar"></p>
<h3 id="使用支持ninja的CLion版本-可选-最新版是支持的"><a href="#使用支持ninja的CLion版本-可选-最新版是支持的" class="headerlink" title="使用支持ninja的CLion版本(可选, 最新版是支持的)"></a>使用支持ninja的CLion版本(可选, 最新版是支持的)</h3><blockquote>
<p>CLion中的CMake使用选项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-DCMAKE_CXX_COMPILER_LAUNCHER&#x3D;ccache</span><br><span class="line">-DCMAKE_BUILD_TYPE&#x3D;Debug</span><br><span class="line">-GNinja</span><br><span class="line">-DENABLE_CLICKHOUSE_ALL&#x3D;OFF</span><br><span class="line">-DENABLE_CLICKHOUSE_SERVER&#x3D;ON</span><br><span class="line">-DENABLE_CLICKHOUSE_CLIENT&#x3D;ON</span><br><span class="line">-DUSE_STATIC_LIBRARIES&#x3D;OFF</span><br><span class="line">-DCLICKHOUSE_SPLIT_BINARY&#x3D;ON</span><br><span class="line">-DSPLIT_SHARED_LIBRARIES&#x3D;ON</span><br><span class="line">-DENABLE_LIBRARIES&#x3D;OFF</span><br><span class="line">-DENABLE_UTILS&#x3D;OFF</span><br><span class="line">-DENABLE_TESTS&#x3D;OFF</span><br><span class="line">-DUSE_ROCKSDB&#x3D;ON</span><br><span class="line">-DENABLE_ROCKSDB&#x3D;ON</span><br><span class="line">-DUSE_INTERNAL_ROCKSDB_LIBRARY&#x3D;ON</span><br><span class="line">-DENABLE_PROTOBUF&#x3D;ON</span><br><span class="line">-DENABLE_GRPC&#x3D;ON</span><br></pre></td></tr></table></figure><br><img src="/images/clickhouse/2.png" alt="avatar"></p>
</blockquote>
<h3 id="点Tools-gt-CMake→Reset-Cache-and-Reload-Project"><a href="#点Tools-gt-CMake→Reset-Cache-and-Reload-Project" class="headerlink" title="点Tools-&gt;CMake→Reset Cache and Reload Project"></a>点Tools-&gt;CMake→Reset Cache and Reload Project</h3><p><img src="/images/clickhouse/3.png" alt="avatar"></p>
<blockquote>
<p>load过程可能会遇到的错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMake Error at contrib&#x2F;croaring-cmake&#x2F;CMakeLists.txt:22 (add_library):Cannot find source file:…</span><br></pre></td></tr></table></figure><br>执行git submodule update —init —recursive 重新拉取相关依赖</p>
</blockquote>
<h3 id="编译clickhouse-server"><a href="#编译clickhouse-server" class="headerlink" title="编译clickhouse-server"></a>编译clickhouse-server</h3><p>1&gt; 点右上角锤子进行编译<br><img src="/images/clickhouse/4.png" alt="avatar"><br>2&gt; 查看编译进度<br><img src="/images/clickhouse/5.png" alt="avatar"></p>
<h3 id="debug方式运行"><a href="#debug方式运行" class="headerlink" title="debug方式运行"></a>debug方式运行</h3><ul>
<li><ol>
<li>debug时需要指定配置文件config.xml路径<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--config-file&#x3D;&#x2F;Users&#x2F;blanklin&#x2F;Code&#x2F;cpp&#x2F;clickhouse-debug&#x2F;conf&#x2F;config.xml</span><br></pre></td></tr></table></figure>
<img src="/images/clickhouse/7.png" alt="avatar"></li>
</ol>
</li>
<li><ol>
<li>点右侧的蜘蛛按钮进行debug<br><img src="/images/clickhouse/6.png" alt="avatar"></li>
</ol>
</li>
</ul>
<h3 id="cpp快速入门"><a href="#cpp快速入门" class="headerlink" title="cpp快速入门"></a>cpp快速入门</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; main() 是程序开始执行的地方</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">   cout &lt;&lt; &quot;Hello World&quot;; &#x2F;&#x2F; 输出 Hello World</span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们讲解一下上面这段程序：</p>
<ul>
<li>C++ 语言定义了一些头文件，这些头文件包含了程序中必需的或有用的信息。上面这段程序中，包含了头文件 <iostream>。</li>
<li>using namespace std; 告诉编译器使用 std 命名空间。命名空间是 C++ 中一个相对新的概念。</li>
<li>// main() 是程序开始执行的地方 是一个单行注释。单行注释以 // 开头，在行末结束。</li>
<li>int main() 是主函数，程序从这里开始执行。</li>
<li>cout &lt;&lt; “Hello World”; 会在屏幕上显示消息 “Hello World”。</li>
<li>return 0; 终止 main( )函数，并向调用进程返回值 0。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/13/java-cpu-high/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/13/java-cpu-high/" class="post-title-link" itemprop="url">java应用cpu打满排查过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-13 10:09:55" itemprop="dateCreated datePublished" datetime="2021-07-13T10:09:55+08:00">2021-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sre/" itemprop="url" rel="index"><span itemprop="name">sre</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="查询cpu的过程"><a href="#查询cpu的过程" class="headerlink" title="查询cpu的过程"></a>查询cpu的过程</h3><ul>
<li><ol>
<li>查看应用的pid,我的应用名称是以dlap开头<br>jps的命令参数如下，<code>jps [options] [hostid]</code> <ul>
<li>-q 不输出类名、Jar名和传入main方法的参数</li>
<li>-m 输出传入main方法的参数</li>
<li>-l 输出main类或Jar的全限名</li>
<li>-v 输出传入JVM的参数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jps -m -l</span><br><span class="line">或者</span><br><span class="line">ps -ef | grep dlap | grep -v grep</span><br><span class="line">或者</span><br><span class="line">ps aux | grep dlap | grep -v greppid</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/1.png" alt="avatar"></li>
</ul>
</li>
</ol>
</li>
<li><ol>
<li>查看系统资源占用信息，使用<code>top</code>查一下当前进程<code>pid</code>占用较高的<code>cpu</code>线程<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">top -Hp pid</span><br><span class="line">&#x2F;&#x2F; 也可以用以下两个命令</span><br><span class="line">ps -Lfp pid</span><br><span class="line">&#x2F;&#x2F; 或者</span><br><span class="line">ps -mp pid -o THREAD, tid, time | sort -rn</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/2.png" alt="avatar"></li>
</ol>
</li>
<li><ol>
<li>将需要的线程<code>ID</code>转换为<code>16</code>进制格式，可以使用<code>printf &quot;%x\n&quot; tid</code>命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;%x\n&quot; tid</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/3.png" alt="avatar"></li>
</ol>
</li>
<li><ol>
<li>打印线程堆栈信息，可以使用命令<code>jstack pid | grep tid</code>，注意这里的tid是线程ID的16进制值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack pid | grep tid</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/4.png" alt="avatar"></li>
</ol>
</li>
</ul>
<h3 id="jmap命令介绍"><a href="#jmap命令介绍" class="headerlink" title="jmap命令介绍"></a>jmap命令介绍</h3><blockquote>
<p>jmap可以导出堆内容，然后使用jhat进行分析，语法如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">       jmap - Prints shared object memory maps or heap memory details for a process, core file, or remote debug server. This command is</span><br><span class="line">       experimental and unsupported.</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       jmap [ options ] pid</span><br><span class="line">       jmap [ options ] executable core</span><br><span class="line">       jmap [ options ] [ pid ] server-id@ ] remote-hostname-or-IP</span><br></pre></td></tr></table></figure></p>
<ul>
<li>根据pid查看堆内存使用情况，包括使用的GC算法、堆配置参数和各代中堆内存使用情况<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -heap pid</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/5.png" alt="avatar"></li>
</ul>
</blockquote>
<ul>
<li>根据pid查看堆内存中的对象数目、大小统计直方图，如果带上live则只统计活对象<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -histo:live pid | more</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/6.png" alt="avatar"><blockquote>
<p>class name是对象类型，说明如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">B  byte</span><br><span class="line">C  char</span><br><span class="line">D  double</span><br><span class="line">F  float</span><br><span class="line">I  int</span><br><span class="line">J  long</span><br><span class="line">Z  boolean</span><br><span class="line">[  数组，如[I表示int[]</span><br><span class="line">[L+类名 其他对象</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li>用jmap把进程内存使用情况dump到文件中，再用jhat分析查看<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:format&#x3D;b,file&#x3D;dumpFileName pid</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/7.png" alt="avatar"></li>
<li>用jhat查看<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jhat -port 9998 &#x2F;tmp&#x2F;dump.dat</span><br><span class="line">&#x2F;&#x2F; 注意如果Dump文件太大，可能需要加上-J-Xmx512m这种参数指定最大堆内存</span><br><span class="line">jhat -J-Xmx512m -port 9998 &#x2F;tmp&#x2F;dump.dat</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/8.png" alt="avatar"><blockquote>
<p>然后用浏览器打开，<a href="http://ip:9998" target="_blank" rel="noopener">http://ip:9998</a></p>
</blockquote>
</li>
</ul>
<h3 id="jstat-JVM统计监测工具"><a href="#jstat-JVM统计监测工具" class="headerlink" title="jstat(JVM统计监测工具)"></a>jstat(JVM统计监测工具)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">       jstat - Monitors Java Virtual Machine (JVM) statistics. This command is experimental and unsupported.</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">           jstat [ generalOption | outputOptions vmid [ interval[s|ms] [ count ] ]</span><br><span class="line"></span><br><span class="line">       generalOption</span><br><span class="line">           A single general command-line option -help or -options. See General Options.</span><br><span class="line"></span><br><span class="line">       outputOptions</span><br><span class="line">           One or more output options that consist of a single statOption, plus any of the -t, -h, and -J options. See Output Options.</span><br><span class="line"></span><br><span class="line">       vmid</span><br><span class="line">           Virtual machine identifier, which is a string that indicates the target JVM. The general syntax is the following:</span><br><span class="line"></span><br><span class="line">               [protocol:][&#x2F;&#x2F;]lvmid[@hostname[:port]&#x2F;servername]</span><br><span class="line"></span><br><span class="line">           The syntax of the vmid string corresponds to the syntax of a URI. The vmid string can vary from a simple integer that</span><br><span class="line">           represents a local JVM to a more complex construction that specifies a communications protocol, port number, and other</span><br><span class="line">           implementation-specific values. See Virtual Machine Identifier.</span><br><span class="line"></span><br><span class="line">       interval [s|ms]</span><br><span class="line">           Sampling interval in the specified units, seconds (s) or milliseconds (ms). Default units are milliseconds. Must be a positive</span><br><span class="line">           integer. When specified, the jstat command produces its output at each interval.</span><br><span class="line"></span><br><span class="line">       count</span><br><span class="line">           Number of samples to display. The default value is infinity which causes the jstat command to display statistics until the</span><br><span class="line">           target JVM terminates or the jstat command is terminated. This value must be a positive integer.</span><br></pre></td></tr></table></figure>
<ul>
<li>根据pid 间隔250ms 采样条数4 输出GC信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc pid 250 4</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/9.png" alt="avatar"><blockquote>
<p>jvm 堆内容布局<br><img src="/images/java_high_cpu/10.png" alt="avatar"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">堆内存 &#x3D; 年轻代 + 年老代 + 永久代  </span><br><span class="line">年轻代 &#x3D; Eden区 + 两个Survivor区（From和To）</span><br></pre></td></tr></table></figure>
<p>各列含义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">S0C、S1C、S0U、S1U：Survivor 0&#x2F;1区容量（Capacity）和使用量（Used）</span><br><span class="line">EC、EU：Eden区容量和使用量</span><br><span class="line">OC、OU：年老代容量和使用量</span><br><span class="line">PC、PU：永久代容量和使用量</span><br><span class="line">YGC、YGT：年轻代GC次数和GC耗时</span><br><span class="line">FGC、FGCT：Full GC次数和Full GC耗时</span><br><span class="line">GCT：GC总耗时</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h3 id="hprof用法"><a href="#hprof用法" class="headerlink" title="hprof用法"></a>hprof用法</h3><blockquote>
<p>hprof 能展现cpu使用率，堆内存使用情况，语法格式如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -agentlib:hprof[&#x3D;options] ToBeProfiledClass</span><br><span class="line">java -Xrunprof[:options] ToBeProfiledClass</span><br><span class="line">javac -J-agentlib:hprof[&#x3D;options] ToBeProfiledClass</span><br></pre></td></tr></table></figure><br>完整的命令格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Option Name and Value  Description                    Default</span><br><span class="line">---------------------  -----------                    -------</span><br><span class="line">heap&#x3D;dump|sites|all    heap profiling                 all</span><br><span class="line">cpu&#x3D;samples|times|old  CPU usage                      off</span><br><span class="line">monitor&#x3D;y|n            monitor contention             n</span><br><span class="line">format&#x3D;a|b             text(txt) or binary output     a</span><br><span class="line">file&#x3D;&lt;file&gt;            write data to file             java.hprof[.txt]</span><br><span class="line">net&#x3D;&lt;host&gt;:&lt;port&gt;      send data over a socket        off</span><br><span class="line">depth&#x3D;&lt;size&gt;           stack trace depth              4</span><br><span class="line">interval&#x3D;&lt;ms&gt;          sample interval in ms          10</span><br><span class="line">cutoff&#x3D;&lt;value&gt;         output cutoff point            0.0001</span><br><span class="line">lineno&#x3D;y|n             line number in traces?         y</span><br><span class="line">thread&#x3D;y|n             thread in traces?              n</span><br><span class="line">doe&#x3D;y|n                dump on exit?                  y</span><br><span class="line">msa&#x3D;y|n                Solaris micro state accounting n</span><br><span class="line">force&#x3D;y|n              force output to &lt;file&gt;         y</span><br><span class="line">verbose&#x3D;y|n            print messages about dumps     y</span><br></pre></td></tr></table></figure></p>
<ul>
<li>每隔20毫秒采样CPU消耗信息，堆栈深度为3<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -agentlib:hprof&#x3D;cpu&#x3D;samples,interval&#x3D;20,depth&#x3D;3 Hello.java</span><br></pre></td></tr></table></figure></li>
<li>获取CPU消耗信息，能够细到每个方法调用的开始和结束，它的实现使用了字节码注入技术（BCI）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -J-agentlib:hprof&#x3D;cpu&#x3D;times Hello.java</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -J-agentlib:hprof&#x3D;heap&#x3D;sites Hello.java</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -J-agentlib:hprof&#x3D;heap&#x3D;dump Hello.java</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意在JVM启动参数中加入-Xrunprof:heap=sites参数可以生成CPU/Heap Profile文件，但对JVM性能影响非常大，不建议在线上服务器环境使用</p>
</blockquote>
<h3 id="jinfo查看jvm启动参数"><a href="#jinfo查看jvm启动参数" class="headerlink" title="jinfo查看jvm启动参数"></a>jinfo查看jvm启动参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 看出所有参数</span><br><span class="line">jinfo -flags pid</span><br><span class="line">&#x2F;&#x2F; 查看某个具体参数,例如InitialHeapSize</span><br><span class="line">jinfo -flag InitialHeapSize pid</span><br></pre></td></tr></table></figure>
<p><img src="/images/java_high_cpu/11.png" alt="avatar"></p>
<ul>
<li>开启/关闭某个jvm参数<blockquote>
<p>使用jinnfo可以在不重启虚拟机的情况下，动态修改jvm的参数，这个方法在生产环境尤其特别有用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; jinfo -flag [+|-]name pid</span><br><span class="line">jinfo -flag +PrintGC pid</span><br><span class="line">jinfo -flag -PrintGC pid</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li>修改某个JVM进程的值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; jinfo -flag name&#x3D;value pid</span><br><span class="line">jinfo -flag InitialHeapSize&#x3D;64g pid</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意并不是所有参数都支持动态修改</p>
</blockquote>
</li>
<li>查看当前jvm进程所有的系统属性<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jinfo -sysprops pid</span><br></pre></td></tr></table></figure>
<img src="/images/java_high_cpu/12.png" alt="avatar"></li>
</ul>
<h3 id="free命令查看机器物理内存"><a href="#free命令查看机器物理内存" class="headerlink" title="free命令查看机器物理内存"></a>free命令查看机器物理内存</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS</span><br><span class="line">       -b, --bytes</span><br><span class="line">              Display the amount of memory in bytes.</span><br><span class="line"></span><br><span class="line">       -k, --kilo</span><br><span class="line">              Display the amount of memory in kilobytes.  This is the default.</span><br><span class="line"></span><br><span class="line">       -m, --mega</span><br><span class="line">              Display the amount of memory in megabytes.</span><br><span class="line"></span><br><span class="line">       -g, --giga</span><br><span class="line">              Display the amount of memory in gigabytes.</span><br><span class="line"></span><br><span class="line">       --tera Display the amount of memory in terabytes.</span><br><span class="line"></span><br><span class="line">       -h, --human</span><br><span class="line">              Show all output fields automatically scaled to shortest three digit unit and display the units of print out.  Following units are used.</span><br><span class="line"></span><br><span class="line">                B &#x3D; bytes</span><br><span class="line">                K &#x3D; kilos</span><br><span class="line">                M &#x3D; megas</span><br><span class="line">                G &#x3D; gigas</span><br><span class="line">                T &#x3D; teras</span><br><span class="line"></span><br><span class="line">              If unit is missing, and you have petabyte of RAM or swap, the number is in terabytes and columns might not be aligned with header.</span><br><span class="line"></span><br><span class="line">       -w, --wide</span><br><span class="line">              Switch to the wide mode. The wide mode produces lines longer than 80 characters. In this mode buffers and cache are reported in two separate columns.</span><br><span class="line"></span><br><span class="line">       -c, --count count</span><br><span class="line">              Display the result count times.  Requires the -s option.</span><br><span class="line"></span><br><span class="line">       -l, --lohi</span><br><span class="line">              Show detailed low and high memory statistics.</span><br><span class="line"></span><br><span class="line">       -s, --seconds seconds</span><br><span class="line">              Continuously display the result delay seconds apart.  You may actually specify any floating point number for delay, usleep(3) is used for microsecond  resolu‐</span><br><span class="line">              tion delay times.</span><br><span class="line"></span><br><span class="line">       --si   Use power of 1000 not 1024.</span><br><span class="line"></span><br><span class="line">       -t, --total</span><br><span class="line">              Display a line showing the column totals.</span><br><span class="line"></span><br><span class="line">       --help Print help.</span><br><span class="line"></span><br><span class="line">       -V, --version</span><br><span class="line">              Display version information.</span><br></pre></td></tr></table></figure>
<p><img src="/images/java_high_cpu/13.png" alt="avatar"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/13/linux-cpu-high/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/13/linux-cpu-high/" class="post-title-link" itemprop="url">linux机器cpu打满排查过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-13 10:09:55" itemprop="dateCreated datePublished" datetime="2021-07-13T10:09:55+08:00">2021-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sre/" itemprop="url" rel="index"><span itemprop="name">sre</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h3><p>接收到告警短信，web应用登陆无响应，请求api均为504</p>
<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>平台无法正常使用</p>
<h3 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h3><p>一般情况下，<code>cpp</code>应用占用<code>cpu</code>较高的原因大部分分为以下两个情况：</p>
<ul>
<li>应用属于计算密集型应用<br>使用大量 <code>CPU</code> 会导致平均负载升高，此时<code>system load</code>和<code>cpu</code>使用数率值上是一致的</li>
<li>应用中出现了<code>IO</code>密集型应用<br>等待 <code>I/O</code> 也会导致平均负载升高，但 <code>CPU</code> 使用率不一定很高，所以<code>system load</code>和<code>cpu</code>使用率并不会一致</li>
</ul>
<h4 id="查询该机器的系统负载-system-load"><a href="#查询该机器的系统负载-system-load" class="headerlink" title="查询该机器的系统负载(system load)"></a>查询该机器的系统负载(system load)</h4><ul>
<li><p>1.系统负载：<br>是指系统cpu繁忙程度的度量指标，即有多少个进程在等待被cpu调度，就是进程等待cpu的队列长度</p>
</li>
<li><p>2.平均负载：<br>是指单位时间内，处于可运行状态和不可中断状态的进程数。所以，它不仅包括了正在使用 <code>CPU</code> 的进程，还包括等待 <code>CPU</code> 和等待 <code>I/O</code> 的进程，实际上是系统的平均活跃进程数统计</p>
</li>
<li><p>3.uptime详解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 观察uptime刷新，w命令&#x2F;top命令皆可查询到系统的平均负载</span><br><span class="line">watch -D uptime</span><br><span class="line">&#x2F;&#x2F; 得到结果</span><br><span class="line"> 11:10:17 up 628 days, 14:06,  2 users,  load average: 0.05, 3.53, 6.59</span><br><span class="line"> &#x2F;&#x2F; 11:10:17是指当前系统时间</span><br><span class="line"> &#x2F;&#x2F; up 628 days, 14:06 是指机器运行时间</span><br><span class="line"> &#x2F;&#x2F; 2 users：是指当前登陆有2个用户</span><br><span class="line"> &#x2F;&#x2F; load average: 0.05, 3.53, 6.59：是指当前1分钟&#x2F;5分钟&#x2F;15分钟的平均负载指</span><br></pre></td></tr></table></figure>
<p>假设平均负载是<code>2</code>，当前<code>cpu</code>数是<code>2cores</code>则说明<code>cpu</code>被<code>100%</code>使用，如果是<code>4cores</code>则说明<code>cpu</code>利用率是<code>50%</code>，如果是<code>1cores</code>，则说明有一半的进程都竞争得不到<code>cpu</code></p>
</li>
<li><p>3.如何查看机器的核心(core)呢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;cpuinfo | grep cores | wc -l</span><br></pre></td></tr></table></figure></li>
<li>4.如何查看机器是否开启超线程呢？<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 如何得到的值和grep cores后得到的核心数一致，则说明未开启</span><br><span class="line">cat &#x2F;proc&#x2F;cpuinfo | grep processor | wc -l</span><br></pre></td></tr></table></figure>
比如我们的机器2颗物理cpu，在每颗物理cpu上又做了6颗逻辑CPU，之后在每颗逻辑CPU上又实现了超线程后，假如此时你在系统中使用<strong>cat /proc/cpuinfo |grep ‘processor’|wc –l</strong>返回24颗，如果load值（15分钟的返回值作为参考依据）长期在24以上，说明系统已经很繁忙了。</li>
</ul>
<h4 id="具体分析系统瓶颈"><a href="#具体分析系统瓶颈" class="headerlink" title="具体分析系统瓶颈"></a>具体分析系统瓶颈</h4><blockquote>
<p>结合平均负载分析，假如我们当前已经知道load很高，但是仍然无法判断是cpu占用率高，还是系统I/O繁忙，又或者是内存不足导致的？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmstat 1</span><br></pre></td></tr></table></figure><br><img src="/images/linux-cpu-high/6.png" alt="cgi"></p>
<ul>
<li>1、procs列<br><strong>r</strong> 列表示运行和等待cpu时间片的进程数，如果长期大于cpu核心数，说明cpu不足，需要增加cpu。<br><strong>b</strong> 列表示在等待资源的进程数，比如正在等待I/O、或者内存交换等。</li>
</ul>
</blockquote>
<ul>
<li><p>2、system 显示采集间隔内发生的中断数<br><strong>in</strong> 列表示在某一时间间隔中观测到的每秒设备中断数。<br><strong>cs</strong> 列表示每秒产生的上下文切换次数，如当 cs 比磁盘 I/O 和网络信息包速率高得多，都应进行进一步调查。</p>
</li>
<li><p>3、memory列<br><strong>swpd</strong> 切换到内存交换区的内存数量(k表示)。如果swpd的值不为0，或者比较大，比如超过了100m，只要<br><strong>free</strong> 当前的空闲页面列表中内存数量(k表示)<br><strong>buff</strong> 作为buffer cache的内存数量，一般对块设备的读写才需要缓冲。<br><strong>cache</strong> 作为page cache的内存数量，一般作为文件系统的cache，如果cache较大，说明用到cache的文件较多，如果此时IO中bi比较小，说明文件系统效率比较好。</p>
</li>
<li><p>4、swap列<br><strong>si</strong> 由内存进入内存交换区数量。<br><strong>so</strong> 由内存交换区进入内存数量。<br><strong>si</strong>、<strong>so</strong>的值长期为0，系统性能还是正常</p>
</li>
<li><p>5、IO列<br><strong>bi</strong> 从块设备读入数据的总量（读磁盘）（每秒kb）。<br><strong>bo</strong> 块设备写入数据的总量（写磁盘）（每秒kb）<br>这里我们设置的bi+bo参考值为1000，如果超过1000，而且wa值较大应该考虑均衡磁盘负载，可以结合iostat输出来分析。</p>
</li>
<li><p>6、cpu列<br><strong>cs</strong> 表示cpu的使用状态<br><strong>us</strong> 列显示了用户方式下所花费 CPU 时间的百分比。us的值比较高时，说明用户进程消耗的cpu时间多，但是如果长期大于50%，需要考虑优化用户的程序。<br><strong>sy</strong> 列显示了内核进程所花费的cpu时间的百分比。这里us + sy的参考值为80%，如果us+sy 大于 80%说明可能存在CPU不足<br><strong>id</strong> 列显示了cpu处在空闲状态的时间百分比<br><strong>wa</strong> 列显示了IO等待所占用的CPU时间的百分比。这里wa的参考值为30%，如果wa超过30%，说明IO等待严重，这可能是磁盘大量随机访问造成的，也可能磁盘或者磁盘访问控制器的带宽瓶颈造成的(主要是块操作)。</p>
</li>
</ul>
<blockquote>
<p>通过以上分析，可以知道当前机器的瓶颈是cpu负载过高，那么如何知道哪个进程占用cpu资源呢？</p>
</blockquote>
<h4 id="查询该机器cpu占用最高的进程"><a href="#查询该机器cpu占用最高的进程" class="headerlink" title="查询该机器cpu占用最高的进程"></a>查询该机器<code>cpu</code>占用最高的进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 每5秒统计一次</span><br><span class="line">pidstat -u 5 1</span><br></pre></td></tr></table></figure>
<p><img src="/images/linux-cpu-high/1.png" alt="cgi"></p>
<blockquote>
<p>也可以使用<code>top</code>命令查询到<code>cpu</code>占用最高的进程</p>
</blockquote>
<h4 id="查询该机器的cpu使用情况"><a href="#查询该机器的cpu使用情况" class="headerlink" title="查询该机器的cpu使用情况"></a>查询该机器的<code>cpu</code>使用情况</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 每5秒刷新一次查看所有cpu的统计情况</span><br><span class="line">mpstat -P ALL 5</span><br></pre></td></tr></table></figure>
<p><img src="/images/linux-cpu-high/2.png" alt="cgi"></p>
<h4 id="查看到进程ID后，可以通过ps-aux-grep-pid查看进程的详情"><a href="#查看到进程ID后，可以通过ps-aux-grep-pid查看进程的详情" class="headerlink" title="查看到进程ID后，可以通过ps aux | grep pid查看进程的详情"></a>查看到进程<code>ID</code>后，可以通过<code>ps aux | grep pid</code>查看进程的详情</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep pid</span><br></pre></td></tr></table></figure>
<p><img src="/images/linux-cpu-high/4.png" alt="cgi"></p>
<h4 id="定位到最耗cpu的进程后，使用top-Hp-pid命令查看线程列表，并找到占用cpu最高的线程"><a href="#定位到最耗cpu的进程后，使用top-Hp-pid命令查看线程列表，并找到占用cpu最高的线程" class="headerlink" title="定位到最耗cpu的进程后，使用top -Hp pid命令查看线程列表，并找到占用cpu最高的线程"></a>定位到最耗<code>cpu</code>的进程后，使用<code>top -Hp pid</code>命令查看线程列表，并找到占用cpu最高的线程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; &#96;tid&#96;表示线程&#96;ID&#96;，&#96;time&#96;表示线程已经运行的时间</span><br><span class="line">&#x2F;&#x2F; 这个命令也一样使用ps -mp pid -o THREAD,tid,time | sort -rn</span><br><span class="line">top -Hp pid</span><br></pre></td></tr></table></figure>
<p><img src="/images/linux-cpu-high/5.png" alt="cgi"></p>
<h4 id="将需要的线程ID转换为16进制格式，可以使用printf-quot-x-n-quot-tid命令"><a href="#将需要的线程ID转换为16进制格式，可以使用printf-quot-x-n-quot-tid命令" class="headerlink" title="将需要的线程ID转换为16进制格式，可以使用printf &quot;%x\n&quot; tid命令"></a>将需要的线程<code>ID</code>转换为<code>16</code>进制格式，可以使用<code>printf &quot;%x\n&quot; tid</code>命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;%x\n&quot; tid</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/21/docker-ipv4-forword/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/21/docker-ipv4-forword/" class="post-title-link" itemprop="url">docker ipv4 forwarding is disabled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-21 17:00:15" itemprop="dateCreated datePublished" datetime="2020-09-21T17:00:15+08:00">2020-09-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>warning ipv4 forwarding is disabled. networking will not work.  </p>
</blockquote>
<ul>
<li>起因<br>今天早上有个同学找过来问为什么xx平台502了，原谅笔者没有没有对该xx平台配置监控告警，原因是这个平台用户数太少。</li>
<li>进入服务器查询<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 查log</span><br><span class="line">docker logs xx</span><br><span class="line">2. 无报错log，查nginx》error.lo</span><br><span class="line">connection timeout...</span><br><span class="line">3. nginx提示连接超时了,ping服务</span><br><span class="line">curl -i http:&#x2F;&#x2F;ip:port&#x2F;api&#x2F;xx&#x2F;yy</span><br><span class="line">4. 给了200的返回码，去外网再ping，</span><br><span class="line">curl: (7) Failed to connect to ip port: Operation timed out</span><br></pre></td></tr></table></figure></li>
<li>结论，外网无法连通这个ip和端口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 重启docker container</span><br><span class="line">sudo docker restart container_name</span><br><span class="line">WARNING: IPv4 forwarding is disabled. Networking will not work.</span><br></pre></td></tr></table></figure></li>
<li><p>docker network bridge<br><img src="/images/docker-bridge.png" alt="docker-bridge"></p>
<blockquote>
<p>由于宿主机的IP地址与容器veth pair的 IP地址均不在同一个网段，故仅仅依靠veth pair和namespace的技术，还不足以使宿主机以外的网络主动发现容器的存在。为了使外界可以访问容器中的进程，docker采用了端口绑定的方式，也就是通过iptables的NAT，将宿主机上的端口流量转发到容器内的端口上。<br>举例说明 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 创建容器，并将宿主机的3306端口绑定到容器的3306端口</span><br><span class="line">docker run -tid --name db -p 3306:3306 MySQL</span><br><span class="line">2. 宿主机上，可以通过iptables -t nat -L -n，查到一条DNAT规则</span><br><span class="line">DNAT tcp -- 0.0.0.0&#x2F;0 0.0.0.0&#x2F;0 tcp dpt:3306 to:172.17.0.5:3306</span><br><span class="line">3. 以上的172.17.0.5即为bridge模式下，创建的容器IP</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>开启 ip 转发</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo echo net.ipv4.ip_forward&#x3D;1 &gt;&gt; &#x2F;etc&#x2F;sysctl.d&#x2F;enable-ip-forward.conf</span><br><span class="line">或者</span><br><span class="line">sudo echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br></pre></td></tr></table></figure></li>
<li>重启 network 服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart network</span><br></pre></td></tr></table></figure></li>
<li>查看 network 服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl net.ipv4.ip_forward</span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回为“net.ipv4.ip_forward = 1”则表示成功了</p>
</blockquote>
</li>
<li>重启容器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker restart container_name</span><br></pre></td></tr></table></figure></li>
<li>如果还提示上面的ipv4问题<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart docker.service</span><br></pre></td></tr></table></figure></li>
<li>删除容器，再run<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker rm -f xx</span><br><span class="line">sudo docker run -d --name xx image_name</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/03/mysql8-forget-password%20copy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/03/mysql8-forget-password%20copy/" class="post-title-link" itemprop="url">mysql8忘记root密码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-03 22:12:55" itemprop="dateCreated datePublished" datetime="2020-09-03T22:12:55+08:00">2020-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>关闭mysqld<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep mysqld | grep -v grep | awk &#39;&#123;print $2&#125;&#39; | xargs kill -9</span><br></pre></td></tr></table></figure></li>
<li>修改my.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;my.conf</span><br><span class="line"># 找到[mysqld]这个section,添加skip-grant-tables,意思是忽略所有表的授权</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure></li>
<li>开启mysqld服务<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld &amp;</span><br></pre></td></tr></table></figure></li>
<li>进入mysql，设置密码为空<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; update user set authentication_string&#x3D;&#39;&#39; where user&#x3D;&#39;root&#39;;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; exit;</span><br></pre></td></tr></table></figure></li>
<li>撤回skip-grant-tables<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;my.conf</span><br><span class="line"># 找到[mysqld]这个section,注释掉skip-grant-tables</span><br></pre></td></tr></table></figure></li>
<li>重启mysqld<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep mysqld | grep -v grep | awk &#39;&#123;print $2&#125;&#39; | xargs kill -9</span><br><span class="line">mysqld &amp;</span><br></pre></td></tr></table></figure></li>
<li>无密码登录mysql<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; ALTER user &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;Qian123#&#39;;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; exit;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/beego-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/beego-install/" class="post-title-link" itemprop="url">beego安装和使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-17 15:09:55" itemprop="dateCreated datePublished" datetime="2020-08-17T15:09:55+08:00">2020-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index"><span itemprop="name">golang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>beego是什么</p>
<blockquote>
<p>beego 是一个快速开发 Go 应用的 HTTP 框架，他可以用来快速开发 API、Web 及后端服务等各种应用，是一个 RESTful 的框架，主要设计灵感来源于 tornado、sinatra 和 flask 这三个框架，但是结合了 Go 本身的一些特性（interface、struct 嵌入等）而设计的一个框架。<a href="https://beego.me" target="_blank" rel="noopener">beego</a></p>
</blockquote>
</li>
<li><p>查看go的安装环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env || grep GO111MODULE</span><br></pre></td></tr></table></figure>
<p><img src="/images/go-env.png" alt="go-env"></p>
</li>
<li><p>打开GO111MODULE</p>
<blockquote>
<p>go在1.11之后推出了自己的官方版本管理工具mod，需要使用mod必须将go的配置参数GO111MODULE打开，用以支持使用模块，注意在打开GO111MODULE后下载的依赖还是存在$GOPATH/pkg/mod中，而go install的结果放在$GOPATH/bin下，但是项目不再局限放在$GOPATH/src下，在任何位置我们都可以使用到$GOPATH/pkg/mod下的依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env -w GO111MODULE&#x3D;on</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>修改go proxy</p>
<blockquote>
<p>由于wall的存在，我们无法使用官方的go proxy，所以需要修改proxy地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env -w GOPROXY&#x3D;https:&#x2F;&#x2F;goproxy.cn,direct</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>安装beego和bee</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com&#x2F;astaxie&#x2F;beego</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装bee工具</p>
<blockquote>
<p>bee 工具是一个为了协助快速开发 beego 项目而创建的项目，您可以通过 bee 快速创建项目、实现热编译、开发测试以及开发完之后打包发布的一整套从创建、开发到部署的方案。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com&#x2F;beego&#x2F;bee</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>把bee添加为系统命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH&#x3D;&#x2F;Users&#x2F;blanklin&#x2F;go</span><br><span class="line">export PATH&#x3D;$PATH:$GOPATH&#x2F;bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建helloworld项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee new helloworld</span><br></pre></td></tr></table></figure></li>
<li><p>helloworld项目目录结构<br>helloworld<br>├── conf<br>│   └── app.conf<br>├── controllers<br>│   └── default.go<br>├── main.go<br>├── models<br>├── routers<br>│   └── router.go<br>├── static<br>│   ├── css<br>│   ├── img<br>│   └── js<br>├── tests<br>│   └── default_test.go<br>└── views<br>  └── index.tpl</p>
</li>
<li><p>新建api项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee api helloworld</span><br></pre></td></tr></table></figure>
</li>
<li><p>api项目目录结构<br>helloworld<br>├── conf<br>│   └── app.conf<br>├── controllers<br>│   └── object.go<br>│   └── user.go<br>├── docs<br>│   └── doc.go<br>├── main.go<br>├── models<br>│   └── object.go<br>│   └── user.go<br>├── routers<br>│   └── router.go<br>└── tests<br>  └── default_test.go</p>
</li>
</ul>
<blockquote>
<p>和web项目对比，少了 static 和 views 目录，多了一个 test 模块，用来做单元测试的<br>可直接通过参数创建orm：bee api [appname] [-tables=””] [-driver=mysql] [-conn=root:@tcp(127.0.0.1:3306)/test]</p>
</blockquote>
<ul>
<li><p>使用go mod</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init helloworld</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行beego项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bee run</span><br><span class="line"># 配合conf&#x2F;app.conf[EnableDocs &#x3D; true]开启swagger</span><br><span class="line">bee run -downdoc&#x3D;true -gendoc&#x3D;true</span><br></pre></td></tr></table></figure>
<blockquote>
<p>打开浏览器访问beego开启的本地端口，一般是8080，所以地址是：<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a></p>
</blockquote>
</li>
<li><p>使用pack命令部署生产环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bee pack -be GOOS&#x3D;linux</span><br><span class="line"># 生成一个压缩文件helloworld.tar.gz</span><br><span class="line"># 在生成环境解压后运行</span><br><span class="line">nohup .&#x2F;helloworld &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用docker部署生产环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">FROM golang:1.14.2-buster</span><br><span class="line"></span><br><span class="line">ENV TZ Asia&#x2F;Shanghai</span><br><span class="line">ENV GOKU_LOGLEVEL info</span><br><span class="line"></span><br><span class="line">ENV GOKU_RUNMODE prod</span><br><span class="line">ENV GOKU_PORT 8080</span><br><span class="line"></span><br><span class="line">RUN go build -v -o .&#x2F;build&#x2F;goku .&#x2F;main.go</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;app</span><br><span class="line"></span><br><span class="line">COPY ..&#x2F;conf &#x2F;app&#x2F;conf</span><br><span class="line">COPY .&#x2F;build&#x2F;goku &#x2F;app&#x2F;goku</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;.&#x2F;goku&quot;]</span><br></pre></td></tr></table></figure></li>
<li>本项目GitHub<br><a href="https://github.com/blanklin030/beego-docker" target="_blank" rel="noopener">https://github.com/blanklin030/beego-docker</a><blockquote>
<p>提供初始化后支持mysql的基础crud和相关配置</p>
</blockquote>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/14/zabbix-source-data-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/14/zabbix-source-data-install/" class="post-title-link" itemprop="url">源码安装zabbix5.0</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-14 11:10:40" itemprop="dateCreated datePublished" datetime="2020-08-14T11:10:40+08:00">2020-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/monitor/" itemprop="url" rel="index"><span itemprop="name">monitor</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>zabbix介绍</p>
<blockquote>
<p>通过<a href="https://www.zabbix.com/cn/whats_new_5_0" target="_blank" rel="noopener">官网</a>我们可以了解zabbix5.0和之前版本的差异及作出的改进</p>
</blockquote>
</li>
<li><p>下载zabbix5.0源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install  epel-release wget tar</span><br><span class="line">wget https:&#x2F;&#x2F;cdn.zabbix.com&#x2F;zabbix&#x2F;sources&#x2F;stable&#x2F;5.0&#x2F;zabbix-5.0.2.tar.gz</span><br><span class="line">tar zxvf zabbix-5.0.2.tar.gz</span><br><span class="line">cd zabbix-5.0.2</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建zabbix用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd zabbix</span><br><span class="line">useradd  -g  zabbix zabbix</span><br><span class="line">usermod  -s  &#x2F;sbin&#x2F;nologin  zabbix</span><br></pre></td></tr></table></figure>
</li>
<li><p>mysql相关操作</p>
<blockquote>
<p>安装mysql5.7请参考<a href="https://blanklin030.github.io/2020/05/13/rmp-install-mysql/" target="_blank" rel="noopener">地址</a></p>
<ul>
<li>创建zabbix数据库并且授权给zabbix@123456访问<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">grant all on zabbix.* to zabbix@localhost identified by &#39;123456&#39;;</span><br><span class="line">flush priviledges;</span><br></pre></td></tr></table></figure></li>
<li>导入zabbix数据到mysql<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uzabbix -p123456 zabbix &lt; database&#x2F;mysql&#x2F;schema.sql</span><br><span class="line">mysql -uzabbix -p123456 zabbix &lt; database&#x2F;mysql&#x2F;images.sql</span><br><span class="line">mysql -uzabbix -p123456 zabbix &lt; database&#x2F;mysql&#x2F;data.sql</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
</li>
<li><p>php7.2安装</p>
<blockquote>
<p>安装php7.2请参考<a href="https://blanklin030.github.io/2020/08/11/php7.2-install/" target="_blank" rel="noopener">地址</a></p>
</blockquote>
</li>
<li><p>nginx安装</p>
<blockquote>
<p>安装nginx请参考<a href="https://blanklin030.github.io/2020/08/11/nginx-install/" target="_blank" rel="noopener">地址</a></p>
</blockquote>
</li>
<li><p>安装zabbix-server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;zabbix  --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2</span><br><span class="line">make&amp;&amp;make install</span><br><span class="line">chown zabbix:zabbix &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F; -R</span><br></pre></td></tr></table></figure></li>
<li>创建软链接,把zabbix命令设置为系统命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F;sbin&#x2F;zabbix_*  &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;</span><br></pre></td></tr></table></figure></li>
<li><p>配置zabbix启动脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在zabbix源码目录下</span><br><span class="line">cp  misc&#x2F;init.d&#x2F;tru64&#x2F;&#123;zabbix_agentd,zabbix_server&#125;  &#x2F;etc&#x2F;init.d&#x2F;;chmod o+x &#x2F;etc&#x2F;init.d&#x2F;zabbix_*</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置zabbix-web</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在zabbix源码目录下</span><br><span class="line">cp -a  ui&#x2F;* &#x2F;var&#x2F;www&#x2F;html&#x2F;zabbix&#x2F;</span><br><span class="line">chown -R nginx:nginx &#x2F;var&#x2F;www&#x2F;html&#x2F;zabbix</span><br></pre></td></tr></table></figure></li>
<li>配置nginx<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen         	80;</span><br><span class="line">    server_name 	localhost;</span><br><span class="line">    set    $host_path 	&quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;zabbix&quot;;</span><br><span class="line">    root &quot;$host_path&quot;;</span><br><span class="line">    index index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass      127.0.0.1:9000;</span><br><span class="line">        fastcgi_index     index.php;</span><br><span class="line">        fastcgi_param     SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        include           fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>配置php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post_max_size &#x3D; 16M</span><br><span class="line">max_execution_time &#x3D; 300</span><br><span class="line">max_input_time &#x3D; 300</span><br><span class="line">date.timezone &#x3D; Asia&#x2F;Shanghai</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 zabbix server 配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F;etc</span><br><span class="line">cp zabbix_server.conf zabbix_server.conf.bak</span><br><span class="line"># 修改以下配置</span><br><span class="line">LogFile&#x3D;&#x2F;tmp&#x2F;zabbix_server.log</span><br><span class="line">DBHost&#x3D;localhost</span><br><span class="line">DBName&#x3D;zabbix</span><br><span class="line">DBUser&#x3D;zabbix</span><br><span class="line">DBPassword&#x3D;123456</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启zabbix server和nginx和php-fpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;zabbix_server  restart</span><br><span class="line">nginx -s reload</span><br><span class="line">systemctl restart php</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问zabbix web gui进行安装配置<br><img src="/images/zabbix-web-1.png" alt="zabbix-web-1"><br><img src="/images/zabbix-web-2.png" alt="zabbix-web-2"><br><img src="/images/zabbix-web-3.png" alt="zabbix-web-3"></p>
</li>
<li><p>源码部署zabbix agent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum -y install curl curl-devel net-snmp net-snmp-devel perl-DBI</span><br><span class="line">groupadd zabbix</span><br><span class="line">useradd -g zabbix zabbix</span><br><span class="line">usermod -s &#x2F;sbin&#x2F;nologin zabbix</span><br><span class="line">tar -xzf zabbix-5.0.2.tar.gz</span><br><span class="line">cd zabbix-5.0.2</span><br><span class="line">.&#x2F;configure  --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;zabbix  --enable-agent</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></li>
<li>创建软链接<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F;sbin&#x2F;zabbix_* &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;</span><br></pre></td></tr></table></figure></li>
<li><p>配置启动脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd zabbix-5.0.2</span><br><span class="line">cp  misc&#x2F;init.d&#x2F;tru64&#x2F;zabbix_agentd  &#x2F;etc&#x2F;init.d&#x2F;zabbix_agentd</span><br><span class="line">chmod o+x &#x2F;etc&#x2F;init.d&#x2F;zabbix_agentd</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F;etc&#x2F;zabbix_agentd.conf</span><br><span class="line">LogFile&#x3D;&#x2F;tmp&#x2F;zabbix_agentd.log</span><br><span class="line">Server&#x3D;192.168.2.214  #server端ip</span><br><span class="line">ServerActive&#x3D;192.168.2.214 #server端ip</span><br><span class="line">Hostname &#x3D; 192.168.2.215  #agent端ip或者是主机名都可以</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动agent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;zabbix_agentd</span><br></pre></td></tr></table></figure></li>
<li>自动发现agent<br><img src="/images/zabbix-web-5.png" alt="zabbix-web-5"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/11/nginx-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Blank Lin">
      <meta itemprop="description" content="say something about me">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlankLin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/11/nginx-install/" class="post-title-link" itemprop="url">centos7源码安装nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-11 14:10:40" itemprop="dateCreated datePublished" datetime="2020-08-11T14:10:40+08:00">2020-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-22 18:09:00" itemprop="dateModified" datetime="2022-08-22T18:09:00+08:00">2022-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web-server/" itemprop="url" rel="index"><span itemprop="name">web server</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="yum安装过程"><a href="#yum安装过程" class="headerlink" title="yum安装过程"></a>yum安装过程</h3><ul>
<li>安装nginx最新源<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;centos&#x2F;7&#x2F;noarch&#x2F;RPMS&#x2F;nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure></li>
<li>安装nginx<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx</span><br></pre></td></tr></table></figure></li>
<li>启动nginx<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx</span><br></pre></td></tr></table></figure></li>
<li>设置nginx开机启动<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx.service</span><br><span class="line"># 检查是否成功</span><br><span class="line">systemctl list-dependencies | grep nginx</span><br></pre></td></tr></table></figure></li>
<li><p>通过 egrep 查询 nginx 服务器的用户和用户组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep &#39;^(user|group)&#39; &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>结果示例：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user nginx;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>路径整理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># nginx 配置文件</span><br><span class="line">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line"></span><br><span class="line"># nginx 默认项目路径</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Blank Lin</p>
  <div class="site-description" itemprop="description">say something about me</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Blank Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
